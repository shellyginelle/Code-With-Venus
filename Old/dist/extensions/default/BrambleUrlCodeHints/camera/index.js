define(function(require,exports,module){"use strict";var CommandManager=brackets.getModule("command/CommandManager");var Commands=brackets.getModule("command/Commands");var Interface=require("camera/interface");var Video=require("camera/video");var Photo=require("camera/photo");var persist=require("camera/utils").persist;var navigator=window.navigator;var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;function Camera(deferred,savePath){this._deferred=deferred;this.savePath=savePath;this.video=new Video(this);this.photo=new Photo(this);this.interface=new Interface(this)}Camera.isSupported=!!getUserMedia;Camera.prototype.start=function(){var self=this;getUserMedia.call(navigator,{video:true,audio:false},function(stream){self.video.play(stream)},function(err){self.fail(err)})};Camera.prototype.savePhoto=function(data){var self=this;persist(this.savePath,data,function(err){if(err){return self.fail(err)}CommandManager.execute(Commands.FILE_REFRESH);self.success(self.savePath)})};Camera.prototype.success=function(){this._deferred.resolve.apply(this._deferred,arguments)};Camera.prototype.fail=function(err){this._deferred.reject(err)};module.exports=Camera});