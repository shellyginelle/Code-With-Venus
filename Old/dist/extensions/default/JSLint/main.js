define(function(require,exports,module){"use strict";require("thirdparty/jslint/jslint");var CodeInspection=brackets.getModule("language/CodeInspection"),Editor=brackets.getModule("editor/Editor").Editor,PreferencesManager=brackets.getModule("preferences/PreferencesManager"),Strings=brackets.getModule("strings"),_=brackets.getModule("thirdparty/lodash");var prefs=PreferencesManager.getExtensionPrefs("jslint");var _lastRunOptions;prefs.definePreference("options","object",undefined).on("change",function(e,data){var options=prefs.get("options");if(!_.isEqual(options,_lastRunOptions)){CodeInspection.requestRun(Strings.JSLINT_NAME)}});var ENVIRONMENTS=["browser","node","couch","rhino"];function _getIndentSize(fullPath){return Editor.getUseTabChar(fullPath)?Editor.getTabSize(fullPath):Editor.getSpaceUnits(fullPath)}function lintOneFile(text,fullPath){text=text.replace(/^[ \t]+$/gm,"");var options=prefs.get("options");_lastRunOptions=_.clone(options);if(!options){options={}}else{options=_.clone(options)}if(!options.indent){options.indent=_getIndentSize(fullPath)}var hasEnvironment=_.some(ENVIRONMENTS,function(env){return options[env]!==undefined});if(!hasEnvironment){options.browser=true}var jslintResult=JSLINT(text,options);if(!jslintResult){var errors=JSLINT.errors.filter(function(err){return err!==null});errors=errors.map(function(jslintError){return{pos:{line:jslintError.line-1,ch:jslintError.character-1},message:jslintError.reason,type:CodeInspection.Type.WARNING}});var result={errors:errors};if(errors.length!==JSLINT.errors.length){result.aborted=true;errors[errors.length-1].type=CodeInspection.Type.META}return result}return null}CodeInspection.register("javascript",{name:Strings.JSLINT_NAME,scanFile:lintOneFile})});