(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Slowparse=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=function(){"use strict";var ParseError=require("./ParseError");var checkMixedContent=require("./checkMixedContent").mixedContent;function CSSParser(stream,domBuilder,warnings){this.stream=stream;this.domBuilder=domBuilder;this.warnings=warnings}CSSParser.prototype={cssProperties:["alignment-adjust","alignment-baseline","animation","animation-delay","animation-direction","animation-duration","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","filter","fit","fit-position","flex-align","flex-flow","flex-line-pack","flex-order","flex-pack","float","float-offset","font","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","grid-columns","grid-rows","hanging-punctuation","height","hyphenate-after","hyphenate-before","hyphenate-character","hyphenate-lines","hyphenate-resource","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","opacity","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","phonemes","pitch","pitch-range","play-during","pointer-events","position","presentation-level","punctuation-trim","quotes","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","src","size","speak","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-shadow","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-pitch-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","word-break","word-spacing","word-wrap","z-index","align-content","align-items","align-self","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","justify-content"],_knownCSSProperty:function(propertyName){propertyName=propertyName.replace(/^-.+?-/,"");return this.cssProperties.indexOf(propertyName)>-1},parse:function(){this.rules=[];this.comments=[];var sliceStart=this.stream.pos;this.stream.markTokenStartAfterSpace();this._parseBlockType();var sliceEnd=this.stream.pos;var cssBlock={value:this.stream.text.slice(sliceStart,sliceEnd),parseInfo:{start:sliceStart,end:sliceEnd,rules:this.rules,comments:this.comments}};this.rules=null;this.comments=null;return cssBlock},stripComments:function(term,startPos){var pos,last=term.length,commentStart,commentEnd,prev,next,stripped="";for(pos=0;pos<last;pos++){if(term[pos]==="/"&&pos<last-1&&term[pos+1]==="*"){commentStart=startPos+pos;pos+=3;while(pos<last-1&&term.substr(pos-1,2)!=="*/"){pos++}if(pos>=last-1&&term.substr(pos-1,2)!=="*/")throw new ParseError("UNTERMINATED_CSS_COMMENT",commentStart);commentEnd=startPos+pos+1;this.comments.push({start:commentStart,end:commentEnd})}else{stripped+=term[pos]}}return stripped.trim()},filterComments:function(token){var text=token.value,tsize=text.length,ntsize,stripped=this.stripComments(text,token.interval.start);text=text.replace(/^\s+/,"");text=text.replace(/^\/\*[\w\W]*?\*\/\s*/,"");ntsize=text.length;token.interval.start+=tsize-ntsize;tsize=ntsize;text=text.split("").reverse().join("");text=text.replace(/^\s+/,"");text=text.replace(/^\/\*[\w\W]*?\*\/\s*/,"");ntsize=text.length;token.interval.end-=tsize-ntsize;token.value=stripped},_parseBlockType:function(){if(this.currentRule){this.rules.push(this.currentRule);this.currentRule=null}this.stream.stripCommentBlock();if(this.stream.peek()==="@"){this.stream.eatCSSWhile(/[^\{]/);var token=this.stream.makeToken(),name=token.value.trim();if(name.match(/@(-[^-]+-)?keyframes/)){this.stream.next();this.nested=true;return this._parseSelector()}if(name.match(/@media\s*\([^{)]+\)/)){this.stream.next();this.nested=true;return this._parseSelector()}if(name==="@font-face"){this.stream.rewind(token.value.length);this.stream.markTokenStart();return this._parseSelector()}throw new ParseError("UNKOWN_CSS_KEYWORD",this,token.interval.start,token.interval.end,name)}this._parseSelector()},_parseSelector:function(){this.stream.eatCSSWhile(/[^\{;\}<]/);var token=this.stream.makeToken(),peek=this.stream.peek();if(peek==="}"){this.stream.next();return this._parseBlockType()}if(token===null){if(!this.stream.end()&&this.stream.peek()==="<"){if(this.stream.substream(2)!=="</"){throw new ParseError("HTML_CODE_IN_CSS_BLOCK",this,this.stream.pos-1,this.stream.pos)}return}throw new ParseError("MISSING_CSS_SELECTOR",this,this.stream.pos-1,this.stream.pos)}this.filterComments(token);var selector=token.value,selectorStart=token.interval.start,selectorEnd=token.interval.end;if(selector===""){this._parseBlockType();return}this.currentRule={selector:{value:selector,start:selectorStart,end:selectorEnd},declarations:{start:null,end:null,properties:[]}};if(this.stream.end()||peek==="<"){if(!this.nested){throw new ParseError("UNFINISHED_CSS_SELECTOR",this,selectorStart,selectorEnd,selector)}return}if(!this.stream.end()){var next=this.stream.next(),errorMsg="[_parseBlockType] Expected {, }, ; or :, instead found "+next;if(next==="{"){this.currentRule.declarations.start=this.stream.pos-1;this._parseDeclaration(selector,selectorStart)}else if(next===";"||next==="}"){throw new ParseError("MISSING_CSS_BLOCK_OPENER",this,selectorStart,selectorEnd,selector)}else{throw new ParseError("UNCAUGHT_CSS_PARSE_ERROR",this,token.interval.start,token.interval.end,errorMsg)}}else{throw new ParseError("MISSING_CSS_BLOCK_OPENER",this,selectorStart,selectorEnd,selector)}},_parseDeclaration:function(selector,selectorStart,value){this.stream.markTokenStartAfterSpace();var peek=this.stream.peek();if(peek==="}"){this.stream.next();this.currentRule.declarations.end=this.stream.pos;this.stream.markTokenStartAfterSpace();this._parseBlockType()}else if(value&&(this.stream.end()||peek==="<")){throw new ParseError("MISSING_CSS_BLOCK_CLOSER",this,selectorStart,selectorStart+value.length,value)}else{this._parseProperty(selector,selectorStart)}},_parseProperty:function(selector,selectorStart){this.stream.eatCSSWhile(/[^\{\}<;:]/);var token=this.stream.makeToken();if(token===null){throw new ParseError("MISSING_CSS_PROPERTY",this,selectorStart,selectorStart+selector.length,selector)}this.filterComments(token);var property=token.value,propertyStart=token.interval.start,propertyEnd=token.interval.end;if(property===""){this._parseDeclaration(selector,selectorStart);return}var next=this.stream.next(),errorMsg="[_parseProperty] Expected }, {, <, ; or :, instead found "+next;if(next==="{"){throw new ParseError("MISSING_CSS_BLOCK_CLOSER",this,selectorStart,propertyStart,selector)}if(this.stream.end()&&next!==":"||next==="<"||next==="}"){throw new ParseError("UNFINISHED_CSS_PROPERTY",this,propertyStart,propertyEnd,property)}this.currentProperty={name:{value:property,start:propertyStart,end:propertyEnd}};if(next===":"){if(!(property&&property.match(/^[a-z\-]+$/))||!this._knownCSSProperty(property)){throw new ParseError("INVALID_CSS_PROPERTY_NAME",this,propertyStart,propertyEnd,property)}this.stream.markTokenStartAfterSpace();this._parseValue(selector,selectorStart,property,propertyStart)}else if(next===";"){throw new ParseError("MISSING_CSS_VALUE",this,propertyStart,propertyEnd,property)}else{throw new ParseError("UNCAUGHT_CSS_PARSE_ERROR",this,token.interval.start,token.interval.end,errorMsg)}},_parseValue:function(selector,selectorStart,property,propertyStart){if(property==="content"){this.stream.findContentEnd()}else{this.stream.eatCSSWhile(/[^}<;]/)}var token=this.stream.makeToken();if(token===null){throw new ParseError("MISSING_CSS_VALUE",this,propertyStart,propertyStart+property.length,property)}var next=!this.stream.end()?this.stream.next():"end of stream",errorMsg="[_parseValue] Expected }, <, or ;, instead found "+next;this.filterComments(token);var value=token.value,valueStart=token.interval.start,valueEnd=token.interval.end;if(value===""){throw new ParseError("MISSING_CSS_VALUE",this,this.stream.pos-1,this.stream.pos)}this.currentProperty.value={value:value,start:valueStart,end:valueEnd};if(this.stream.end()&&next!==";"||next==="<"){throw new ParseError("UNFINISHED_CSS_VALUE",this,valueStart,valueEnd,value)}if(checkMixedContent&&value.match(/,?\s*url\(\s*['"]?http:\/\/.+\)/)){valueStart=valueStart+value.indexOf("url");this.warnings.push(new ParseError("CSS_MIXED_ACTIVECONTENT",this,property,propertyStart,value,valueStart,valueEnd))}if(next===";"){this._bindCurrentRule();this.stream.markTokenStartAfterSpace();this._parseDeclaration(selector,valueStart,value)}else if(next==="}"){this.currentRule.declarations.end=this.stream.pos;this._bindCurrentRule();this.stream.markTokenStartAfterSpace();this._parseBlockType()}else{throw new ParseError("UNCAUGHT_CSS_PARSE_ERROR",this,token.interval.start,token.interval.end,errorMsg)}},_bindCurrentRule:function(){this.currentRule.declarations.properties.push(this.currentProperty);this.currentProperty=null}};return CSSParser}()},{"./ParseError":6,"./checkMixedContent":9}],2:[function(require,module,exports){module.exports=function(){"use strict";var DocumentFragment=require("./DocumentFragment");function DOMBuilder(disallowActiveAttributes){this.fragment=new DocumentFragment;this.currentNode=this.fragment.node;this.contexts=[];this.disallowActiveAttributes=disallowActiveAttributes}DOMBuilder.prototype={pushElement:function(tagName,parseInfo,nameSpace){var node=nameSpace?this.fragment.createElementNS(nameSpace,tagName):this.fragment.createElement(tagName);node.parseInfo=parseInfo;this.currentNode.appendChild(node);this.currentNode=node},popElement:function(){this.currentNode=this.currentNode.parentNode},pushContext:function(context,position){this.contexts.push({context:context,position:position})},comment:function(data,parseInfo){var comment=this.fragment.createComment("");comment.nodeValue=data;comment.parseInfo=parseInfo;this.currentNode.appendChild(comment)},attribute:function(name,value,parseInfo){var attrNode=this.fragment.createAttribute(name);attrNode.parseInfo=parseInfo;if(this.disallowActiveAttributes&&name.substring(0,2).toLowerCase()==="on"){attrNode.nodeValue=""}else{attrNode.nodeValue=value}this.currentNode.attributes.push(attrNode);this.currentNode._attributeMap[attrNode.nodeName]=attrNode.nodeValue},text:function(text,parseInfo){var textNode=this.fragment.createTextNode(text);textNode.parseInfo=parseInfo;this.currentNode.appendChild(textNode)}};return DOMBuilder}()},{"./DocumentFragment":3}],3:[function(require,module,exports){module.exports=function(){"use strict";var Node=require("./Node");function DocumentFragment(){this.node=new Node(Node.DOCUMENT_FRAGMENT_NODE,"#document-fragment");this.node._ownerDocument=this}DocumentFragment.prototype={createTextNode:function(data){return new Node(Node.TEXT_NODE,"#text",data)},createElementNS:function(namespaceURI,qualifiedName){return new Node(Node.ELEMENT_NODE,qualifiedName,false,namespaceURI)},createElement:function(tagName){return this.createElementNS(false,tagName)},createComment:function(data){return new Node(Node.COMMENT_NODE,"#comment",data)},createAttribute:function(name){return new Node(Node.ATTRIBUTE_NODE,name)}};return DocumentFragment}()},{"./Node":5}],4:[function(require,module,exports){module.exports=function(){"use strict";var ParseError=require("./ParseError");var CSSParser=require("./CSSParser");var voidHtmlElements=require("./voidHtmlElements");var CHARACTER_ENTITY_REFS={lt:"<",gt:">",apos:"'",quot:'"',amp:"&"};var attributeNameStartChar="A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var nameStartChar=new RegExp("["+attributeNameStartChar+"]");var attributeNameChar=attributeNameStartChar+"0-9\\-\\.\\u00B7\\u0300-\\u036F\\u203F-\\u2040:";var nameChar=new RegExp("["+attributeNameChar+"]");var checkMixedContent=require("./checkMixedContent").mixedContent;function isActiveContent(tagName,attrName){if(attrName==="href"){return["link"].indexOf(tagName)>-1}if(attrName==="src"){return["script","iframe"].indexOf(tagName)>-1}if(attrName==="data"){return["object"].indexOf(tagName)>-1}return false}var activeTagNode=false;var parentTagNode=false;function isNextTagParent(stream,parentTagName){return stream.findNext(/<\/([\w\-]+)\s*>/,1)===parentTagName}function isNextCloseTag(stream){return stream.findNext(/<\/([\w\-]+)\s*>/,1)}function allowsOmmitedEndTag(parentTagName,tagName){if(tagName==="p"){return["a"].indexOf(parentTagName)>-1}return false}function HTMLParser(stream,domBuilder){this.warnings=[];this.stream=stream;this.domBuilder=domBuilder;this.cssParser=new CSSParser(stream,domBuilder,this.warnings)}function replaceEntityRefs(text){return text.replace(/&([A-Za-z]+);/g,function(ref,name){name=name.toLowerCase();if(name in CHARACTER_ENTITY_REFS)return CHARACTER_ENTITY_REFS[name];return ref})}HTMLParser.prototype={parsingSVG:false,svgNameSpace:"http://www.w3.org/2000/svg",html5Doctype:"<!DOCTYPE html>",voidHtmlElements:voidHtmlElements,omittableCloseTagHtmlElements:["p","li","td","th"],omittableCloseTags:{p:["address","article","aside","blockquote","dir","div","dl","fieldset","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","main","nav","ol","p","pre","section","table","ul"],th:["th","td"],td:["th","td"],li:["li"]},htmlElements:["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","bgsound","blink","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","meta","meter","nav","nobr","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","samp","script","section","select","small","source","spacer","span","strong","style","sub","summary","sup","svg","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],svgElements:["a","altglyph","altglyphdef","altglyphitem","animate","animatecolor","animatemotion","animatetransform","circle","clippath","color-profile","cursor","defs","desc","ellipse","feblend","fecolormatrix","fecomponenttransfer","fecomposite","feconvolvematrix","fediffuselighting","fedisplacementmap","fedistantlight","feflood","fefunca","fefuncb","fefuncg","fefuncr","fegaussianblur","feimage","femerge","femergenode","femorphology","feoffset","fepointlight","fespecularlighting","fespotlight","fetile","feturbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialgradient","rect","script","set","stop","style","svg","switch","symbol","text","textpath","title","tref","tspan","use","view","vkern"],attributeNamespaces:["xlink","xml"],obsoleteHtmlElements:["acronym","applet","basefont","big","center","dir","font","isindex","listing","noframes","plaintext","s","strike","tt","xmp"],webComponentElements:["template","shadow","content"],_isCustomElement:function(tagName){return tagName.search(/^[\w\d]+-[\w\d]+$/)>-1},_knownHTMLElement:function(tagName){return this.voidHtmlElements.indexOf(tagName)>-1||this.htmlElements.indexOf(tagName)>-1||this.obsoleteHtmlElements.indexOf(tagName)>-1||this.webComponentElements.indexOf(tagName)>-1},_knownSVGElement:function(tagName){return this.svgElements.indexOf(tagName)>-1},_knownVoidHTMLElement:function(tagName){return this.voidHtmlElements.indexOf(tagName)>-1},_knownOmittableCloseTagHtmlElement:function(tagName){return this.omittableCloseTagHtmlElements.indexOf(tagName)>-1},_knownOmittableCloseTags:function(activeTagName,foundTagName){return this.omittableCloseTags[activeTagName].indexOf(foundTagName)>-1},_supportedAttributeNameSpace:function(ns){return this.attributeNamespaces.indexOf(ns)!==-1},parse:function(){if(this.stream.match(this.html5Doctype,true,true))this.domBuilder.fragment.node.parseInfo={doctype:{start:0,end:this.stream.pos}};while(!this.stream.end()){if(this.stream.peek()=="<"){this._buildTextNode();this._parseStartTag()}else this.stream.next()}this._buildTextNode();if(this.domBuilder.currentNode!=this.domBuilder.fragment.node)throw new ParseError("UNCLOSED_TAG",this);return{warnings:this.warnings.length>0?this.warnings:false}},_buildTextNode:function(){var token=this.stream.makeToken();if(token){this.domBuilder.text(replaceEntityRefs(token.value),token.interval)}},_parseStartTag:function(){if(this.stream.next()!="<")throw new Error('assertion failed, expected to be on "<"');if(this.stream.match("!--",true)){this.domBuilder.pushContext("text",this.stream.pos);this._parseComment();this.domBuilder.pushContext("html",this.stream.pos);return}this.stream.eat(/\//);this.stream.eatWhile(/[\w\d-]/);var token=this.stream.makeToken();var tagName=token.value.slice(1).toLowerCase();if(tagName==="svg")this.parsingSVG=true;if(tagName[0]=="/"){activeTagNode=false;var closeTagName=tagName.slice(1).toLowerCase();if(closeTagName==="svg")this.parsingSVG=false;if(this._knownVoidHTMLElement(closeTagName))throw new ParseError("CLOSE_TAG_FOR_VOID_ELEMENT",this,closeTagName,token);if(!this.domBuilder.currentNode.parseInfo)throw new ParseError("UNEXPECTED_CLOSE_TAG",this,closeTagName,token);this.domBuilder.currentNode.parseInfo.closeTag={start:token.interval.start};var openTagName=this.domBuilder.currentNode.nodeName.toLowerCase();if(closeTagName!=openTagName)throw new ParseError("MISMATCHED_CLOSE_TAG",this,openTagName,closeTagName,token);this._parseEndCloseTag()}else{if(tagName){var badSVG=this.parsingSVG&&!this._knownSVGElement(tagName);var badHTML=!this.parsingSVG&&!this._knownHTMLElement(tagName)&&!this._isCustomElement(tagName);if(badSVG||badHTML){throw new ParseError("INVALID_TAG_NAME",tagName,token)}}else{throw new ParseError("INVALID_TAG_NAME",tagName,token)}var parseInfo={openTag:{start:token.interval.start}};var nameSpace=this.parsingSVG?this.svgNameSpace:undefined;if(activeTagNode&&parentTagNode!=this.domBuilder.fragment.node){var activeTagName=activeTagNode.nodeName.toLowerCase();if(this._knownOmittableCloseTags(activeTagName,tagName)){this.domBuilder.popElement()}}parentTagNode=this.domBuilder.currentNode;this.domBuilder.pushElement(tagName,parseInfo,nameSpace);if(!this.stream.end())this._parseEndOpenTag(tagName)}},_parseComment:function(){var token;while(!this.stream.end()){if(this.stream.match("-->",true)){token=this.stream.makeToken();this.domBuilder.comment(token.value.slice(4,-3),token.interval);return}this.stream.next()}token=this.stream.makeToken();throw new ParseError("UNTERMINATED_COMMENT",token)},_parseCDATA:function(tagname){var token,matchString="</"+tagname+">",text,textInterval={start:0,end:0},openTagEnd=this.domBuilder.currentNode.parseInfo.openTag.end,closeTagInterval;this.stream.makeToken();while(!this.stream.end()){if(this.stream.match(matchString,true)){token=this.stream.makeToken();text=token.value.slice(0,-matchString.length);closeTagInterval={start:openTagEnd+text.length,end:token.interval.end};this.domBuilder.currentNode.parseInfo.closeTag=closeTagInterval;textInterval.start=token.interval.start;textInterval.end=token.interval.end-(closeTagInterval.end-closeTagInterval.start);this.domBuilder.text(text,textInterval);this.domBuilder.popElement();return}this.stream.next()}throw new ParseError("UNCLOSED_TAG",this)},containsAttribute:function(stream){return stream.eat(nameStartChar)},_parseEndCloseTag:function(){this.stream.eatSpace();if(this.stream.next()!=">"){if(this.containsAttribute(this.stream)){throw new ParseError("ATTRIBUTE_IN_CLOSING_TAG",this)}else{throw new ParseError("UNTERMINATED_CLOSE_TAG",this)}}var end=this.stream.makeToken().interval.end;this.domBuilder.currentNode.parseInfo.closeTag.end=end;this.domBuilder.popElement()},_parseEndOpenTag:function(tagName){var tagMark=this.stream.pos,startMark=this.stream.pos;while(!this.stream.end()){if(this.containsAttribute(this.stream)){if(this.stream.peek!=="="){this.stream.eatWhile(nameChar)}this._parseAttribute(tagName)}else if(this.stream.eatSpace()){this.stream.makeToken();startMark=this.stream.pos}else if(this.stream.peek()==">"||this.stream.match("/>")){var selfClosing=this.stream.match("/>",true);if(selfClosing){if(!this.parsingSVG&&!this._knownVoidHTMLElement(tagName))throw new ParseError("SELF_CLOSING_NON_VOID_ELEMENT",this,tagName)}else this.stream.next();var end=this.stream.makeToken().interval.end;this.domBuilder.currentNode.parseInfo.openTag.end=end;if(tagName&&(selfClosing&&this._knownSVGElement(tagName)||this._knownVoidHTMLElement(tagName)))this.domBuilder.popElement();activeTagNode=false;if(tagName&&this._knownOmittableCloseTagHtmlElement(tagName)){activeTagNode=this.domBuilder.currentNode}if(!this.stream.end()&&tagName==="style"){this.domBuilder.pushContext("css",this.stream.pos);var cssBlock=this.cssParser.parse();this.domBuilder.pushContext("html",this.stream.pos);this.domBuilder.text(cssBlock.value,cssBlock.parseInfo)}if(tagName&&tagName==="script"){this.domBuilder.pushContext("javascript",this.stream.pos);this._parseCDATA("script");this.domBuilder.pushContext("html",this.stream.pos)}if(tagName&&tagName==="textarea"){this.domBuilder.pushContext("text",this.stream.pos);this._parseCDATA("textarea");this.domBuilder.pushContext("html",this.stream.pos)}if(parentTagNode&&parentTagNode!=this.domBuilder.fragment.node){var parentTagName=parentTagNode.nodeName.toLowerCase(),nextIsParent=isNextTagParent(this.stream,parentTagName),needsEndTag=!allowsOmmitedEndTag(parentTagName,tagName),optionalEndTag=this._knownOmittableCloseTagHtmlElement(parentTagName),nextTagCloses=isNextCloseTag(this.stream);if(nextIsParent&&(needsEndTag||optionalEndTag&&nextTagCloses)){if(this._knownOmittableCloseTagHtmlElement(tagName)){this.domBuilder.popElement()}}}return}else{this.stream.eatWhile(/[^'"\s=<>]/);var attrToken=this.stream.makeToken();if(!attrToken){this.stream.tokenStart=tagMark;attrToken=this.stream.makeToken();var peek=this.stream.peek();if(peek==="'"||peek==='"'){this.stream.next();this.stream.eatWhile(new RegExp("[^"+peek+"]"));this.stream.next();var token=this.stream.makeToken();throw new ParseError("UNBOUND_ATTRIBUTE_VALUE",this,token)}throw new ParseError("UNTERMINATED_OPEN_TAG",this)}attrToken.interval.start=startMark;throw new ParseError("INVALID_ATTR_NAME",this,attrToken)}}},_parseAttribute:function(tagName){var nameTok=this.stream.makeToken();nameTok.value=nameTok.value.toLowerCase();this.stream.eatSpace();if(this.stream.peek()=="="){this.stream.next();if(nameTok.value.indexOf(":")!==-1){var parts=nameTok.value.split(":");if(parts.length>2){throw new ParseError("MULTIPLE_ATTR_NAMESPACES",this,nameTok)}var nameSpace=parts[0],attributeName=parts[1];if(!this._supportedAttributeNameSpace(nameSpace)){throw new ParseError("UNSUPPORTED_ATTR_NAMESPACE",this,nameTok)}}this.stream.eatSpace();this.stream.makeToken();var quoteType=this.stream.next();if(quoteType!=='"'&&quoteType!=="'"){throw new ParseError("UNQUOTED_ATTR_VALUE",this)}if(quoteType==='"'){this.stream.eatWhile(/[^"]/)}else{this.stream.eatWhile(/[^']/)}if(this.stream.next()!==quoteType){throw new ParseError("UNTERMINATED_ATTR_VALUE",this,nameTok)}var valueTok=this.stream.makeToken();if(checkMixedContent&&valueTok.value.match(/http:/)&&isActiveContent(tagName,nameTok.value)){this.warnings.push(new ParseError("HTTP_LINK_FROM_HTTPS_PAGE",this,nameTok,valueTok))}var unquotedValue=replaceEntityRefs(valueTok.value.slice(1,-1));this.domBuilder.attribute(nameTok.value,unquotedValue,{name:nameTok.interval,value:valueTok.interval})}else{this.stream.makeToken();this.domBuilder.attribute(nameTok.value,"",{name:nameTok.interval})}}};HTMLParser.replaceEntityRefs=replaceEntityRefs;return HTMLParser}()},{"./CSSParser":1,"./ParseError":6,"./checkMixedContent":9,"./voidHtmlElements":11}],5:[function(require,module,exports){module.exports=function(){"use strict";var voidHtmlElements=require("./voidHtmlElements");function Node(nodeType,nodeName,nodeValue,namespaceURI){this.nodeType=nodeType;this.nodeValue=nodeValue||"";this.namespaceURI=namespaceURI||"";this.parentNode=false;this.nextSibling=false;this.isVoid=voidHtmlElements.indexOf(nodeName)>-1;this.childNodes=[];this.attributes=[];this._attributeMap={};switch(this.nodeType){case Node.ELEMENT_NODE:this.nodeName=nodeName.toUpperCase();break;case Node.ATTRIBUTE_NODE:this.nodeName=nodeName.toLowerCase();break;default:this.nodeName=nodeName}}Node.prototype={appendChild:function(node){var lastChild=this.childNodes.slice(-1)[0];if(lastChild){lastChild.nextSibling=node}node.parentNode=this;this.childNodes.push(node)},clone:function(){var node=new Node(this.nodeType,this.nodeName,this.nodeValue,this.namespaceURI);node.nextSibling=this.nextSibling?this.nextSibling.clone():false;node.isVoid=this.isVoid;node.childNodes=this.childNodes.map(function(childNode){return childNode.clone()});node.attributes=this.attributes.map(function(attribute){return attribute.clone()});node._attributeMap=this._attributeMap;return node},getAttribute:function(name){return this.nodeType===Node.ELEMENT_NODE&&this._attributeMap[name.toLowerCase()]}};Object.defineProperties(Node.prototype,{innerHTML:{get:function(){if(this.nodeType!==Node.ELEMENT_NODE){return null}var innerHTML="";this.childNodes.forEach(function(childNode){innerHTML+=childNode.outerHTML||""});return innerHTML}},outerHTML:{get:function(){if(this.nodeType===Node.ATTRIBUTE_NODE){return null}if(this.nodeType===Node.COMMENT_NODE){return"<!--"+this.nodeValue+"-->"}if(this.nodeType!==Node.ELEMENT_NODE){return this.nodeValue}var attributes=this._attributeMap;var attributeStr="";attributeStr=Object.keys(attributes).map(function(attrName){return attrName+'="'+attributes[attrName]+'"'}).join(" ");if(attributeStr.length>0){attributeStr=" "+attributeStr}var nodeName=this.nodeName.toLowerCase();var openingTag="<"+nodeName+attributeStr+">";var closingTag=this.isVoid?"":"</"+nodeName+">";return openingTag+(this.innerHTML||"")+closingTag}}});Node.ELEMENT_NODE=1;Node.ATTRIBUTE_NODE=2;Node.TEXT_NODE=3;Node.COMMENT_NODE=8;Node.DOCUMENT_FRAGMENT_NODE=11;return Node}()},{"./voidHtmlElements":11}],6:[function(require,module,exports){module.exports=function(){"use strict";var ParseErrorBuilders=require("./ParseErrorBuilders");function ParseError(type){this.name="ParseError";if(!(type in ParseErrorBuilders))throw new Error("Unknown ParseError type: "+type);var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);var parseInfo=ParseErrorBuilders[type].apply(ParseErrorBuilders,args);parseInfo=ParseErrorBuilders._combine({type:type},parseInfo);this.message=type;this.parseInfo=parseInfo}ParseError.prototype=Error.prototype;return ParseError}()},{"./ParseErrorBuilders":7}],7:[function(require,module,exports){module.exports=function(){"use strict";var ParseErrorBuilders={_combine:function(a,b){var obj={},name;for(name in a){obj[name]=a[name]}for(name in b){obj[name]=b[name]}return obj},UNCLOSED_TAG:function(parser){var currentNode=parser.domBuilder.currentNode,openTag=this._combine({name:currentNode.nodeName.toLowerCase()},currentNode.parseInfo.openTag);return{openTag:openTag,cursor:openTag.start}},INVALID_TAG_NAME:function(tagName,token){var openTag=this._combine({name:tagName},token.interval);return{openTag:openTag,cursor:openTag.start}},UNEXPECTED_CLOSE_TAG:function(parser,closeTagName,token){var closeTag=this._combine({name:closeTagName},token.interval);return{closeTag:closeTag,cursor:closeTag.start}},MISMATCHED_CLOSE_TAG:function(parser,openTagName,closeTagName,token){var openTag=this._combine({name:openTagName},parser.domBuilder.currentNode.parseInfo.openTag),closeTag=this._combine({name:closeTagName},token.interval);return{openTag:openTag,closeTag:closeTag,cursor:closeTag.start}},ATTRIBUTE_IN_CLOSING_TAG:function(parser){var currentNode=parser.domBuilder.currentNode;
var end=parser.stream.pos;if(!parser.stream.end()){end=parser.stream.makeToken().interval.start}var closeTag={name:currentNode.nodeName.toLowerCase(),start:currentNode.parseInfo.closeTag.start,end:end};return{closeTag:closeTag,cursor:closeTag.start}},CLOSE_TAG_FOR_VOID_ELEMENT:function(parser,closeTagName,token){var closeTag=this._combine({name:closeTagName},token.interval);return{closeTag:closeTag,cursor:closeTag.start}},UNTERMINATED_COMMENT:function(token){var commentStart=token.interval.start;return{start:commentStart,cursor:commentStart}},UNTERMINATED_ATTR_VALUE:function(parser,nameTok){var currentNode=parser.domBuilder.currentNode,openTag=this._combine({name:currentNode.nodeName.toLowerCase()},currentNode.parseInfo.openTag),valueTok=parser.stream.makeToken(),attribute={name:{value:nameTok.value,start:nameTok.interval.start,end:nameTok.interval.end},value:{start:valueTok.interval.start}};return{openTag:openTag,attribute:attribute,cursor:attribute.value.start}},UNQUOTED_ATTR_VALUE:function(parser){var pos=parser.stream.pos;if(!parser.stream.end()){pos=parser.stream.makeToken().interval.start}return{start:pos,cursor:pos}},INVALID_ATTR_NAME:function(parser,attrToken){return{start:attrToken.interval.start,end:attrToken.interval.end,attribute:{name:{value:attrToken.value}},cursor:attrToken.interval.start}},MULTIPLE_ATTR_NAMESPACES:function(parser,attrToken){return{start:attrToken.interval.start,end:attrToken.interval.end,attribute:{name:{value:attrToken.value}},cursor:attrToken.interval.start}},UNSUPPORTED_ATTR_NAMESPACE:function(parser,attrToken){return{start:attrToken.interval.start,end:attrToken.interval.end,attribute:{name:{value:attrToken.value}},cursor:attrToken.interval.start}},UNBOUND_ATTRIBUTE_VALUE:function(parser,valueToken){return{value:valueToken.value,interval:valueToken.interval,cursor:valueToken.interval.start}},UNTERMINATED_OPEN_TAG:function(parser){var currentNode=parser.domBuilder.currentNode,openTag={start:currentNode.parseInfo.openTag.start,end:parser.stream.pos,name:currentNode.nodeName.toLowerCase()};return{openTag:openTag,cursor:openTag.start}},SELF_CLOSING_NON_VOID_ELEMENT:function(parser,tagName){var start=parser.domBuilder.currentNode.parseInfo.openTag.start,end=parser.stream.makeToken().interval.end;return{name:tagName,start:start,end:end,cursor:start}},UNTERMINATED_CLOSE_TAG:function(parser){var currentNode=parser.domBuilder.currentNode;var end=parser.stream.pos;if(!parser.stream.end()){end=parser.stream.makeToken().interval.start}var closeTag={name:currentNode.nodeName.toLowerCase(),start:currentNode.parseInfo.closeTag.start,end:end};return{closeTag:closeTag,cursor:closeTag.start}},HTTP_LINK_FROM_HTTPS_PAGE:function(parser,nameTok,valueTok){var currentNode=parser.domBuilder.currentNode,openTag=this._combine({name:currentNode.nodeName.toLowerCase()},currentNode.parseInfo.openTag),attribute={name:{value:nameTok.value,start:nameTok.interval.start,end:nameTok.interval.end},value:{start:valueTok.interval.start+1,end:valueTok.interval.end-1}};return{openTag:openTag,attribute:attribute,cursor:attribute.value.start}},UNKOWN_CSS_KEYWORD:function(parser,start,end,value){return{cssKeyword:{start:start,end:end,value:value},cursor:start}},MISSING_CSS_SELECTOR:function(parser,start,end){return{cssBlock:{start:start,end:end},cursor:start}},UNFINISHED_CSS_SELECTOR:function(parser,start,end,selector){return{cssSelector:{start:start,end:end,selector:selector},cursor:start}},MISSING_CSS_BLOCK_OPENER:function(parser,start,end,selector){return{cssSelector:{start:start,end:end,selector:selector},cursor:start}},INVALID_CSS_PROPERTY_NAME:function(parser,start,end,property){return{cssProperty:{start:start,end:end,property:property},cursor:start}},MISSING_CSS_PROPERTY:function(parser,start,end,selector){return{cssSelector:{start:start,end:end,selector:selector},cursor:start}},UNFINISHED_CSS_PROPERTY:function(parser,start,end,property){return{cssProperty:{start:start,end:end,property:property},cursor:start}},MISSING_CSS_VALUE:function(parser,start,end,property){return{cssProperty:{start:start,end:end,property:property},cursor:start}},UNFINISHED_CSS_VALUE:function(parser,start,end,value){return{cssValue:{start:start,end:end,value:value},cursor:start}},CSS_MIXED_ACTIVECONTENT:function(parser,property,propertyStart,value,valueStart,valueEnd){var cssProperty={property:property,start:propertyStart,end:propertyStart+property.length},cssValue={value:value,start:valueStart,end:valueEnd};return{cssProperty:cssProperty,cssValue:cssValue,cursor:cssValue.start}},MISSING_CSS_BLOCK_CLOSER:function(parser,start,end,value){return{cssValue:{start:start,end:end,value:value},cursor:start}},UNCAUGHT_CSS_PARSE_ERROR:function(parser,start,end,msg){return{error:{start:start,end:end,msg:msg},cursor:start}},UNTERMINATED_CSS_COMMENT:function(start){return{start:start,cursor:start}},HTML_CODE_IN_CSS_BLOCK:function(parser,start,end){return{html:{start:start,end:end},cursor:start}}};return ParseErrorBuilders}()},{}],8:[function(require,module,exports){module.exports=function(){"use strict";var ParseError=require("./ParseError");var ParseErrorBuilders=require("./ParseErrorBuilders");function Stream(text){this.text=text;this.pos=0;this.tokenStart=0}Stream.prototype={peek:function(){return this.text[this.pos]},substream:function(len){return this.text.substring(this.pos,this.pos+len)},next:function(){if(!this.end())return this.text[this.pos++]},rewind:function(x){this.pos-=x;if(this.pos<0){this.pos=0}},end:function(){return this.pos==this.text.length},eat:function(match){if(!this.end()&&this.peek().match(match))return this.next()},eatWhile:function(matcher){var wereAnyEaten=false;while(!this.end()){if(this.eat(matcher))wereAnyEaten=true;else return wereAnyEaten}},eatSpace:function(){return this.eatWhile(/[\s\n]/)},eatCSSWhile:function(matcher){var wereAnyEaten=false,chr="",peek="",next="";while(!this.end()){chr=this.eat(matcher);if(chr)wereAnyEaten=true;else return wereAnyEaten;if(chr==="/"){peek=this.peek();if(peek==="*"){while(next!=="/"&&!this.end()){this.eatWhile(/[^*]/);this.next();next=this.next()}next=""}}}},findContentEnd:function(){var quoted=false,c,_c;while(!this.end()){c=this.next();if(c==='"'||c==="'"){if(quoted===false)quoted=c;else if(quoted===c&&_c!=="\\")quoted=false;continue}if(c===";"&&quoted===false){break}_c=c}this.pos--},stripCommentBlock:function(){if(this.substream(2)!=="/*")return;this.pos+=2;for(;!this.end();this.pos++){if(this.substream(2)==="*/"){this.pos+=2;break}}this.eatSpace()},markTokenStart:function(){this.tokenStart=this.pos},markTokenStartAfterSpace:function(){this.eatSpace();this.markTokenStart()},makeToken:function(){if(this.pos==this.tokenStart)return null;var token={value:this.text.slice(this.tokenStart,this.pos),interval:{start:this.tokenStart,end:this.pos}};this.tokenStart=this.pos;return token},match:function(string,consume,caseFold){var substring=this.text.slice(this.pos,this.pos+string.length);if(caseFold){string=string.toLowerCase();substring=substring.toLowerCase()}if(string==substring){if(consume)this.pos+=string.length;return true}return false},findNext:function(pattern,groupNumber){var currentPos=this.pos;this.eatWhile(/[^>]/);this.next();var nextPos=this.pos;this.pos=currentPos;var token=this.substream(nextPos-currentPos);var captureGroups=token.match(pattern);this.pos=currentPos;if(captureGroups){return captureGroups[groupNumber]}return false}};return Stream}()},{"./ParseError":6,"./ParseErrorBuilders":7}],9:[function(require,module,exports){module.exports={mixedContent:typeof window!=="undefined"?window.location.protocol==="https:":false}},{}],10:[function(require,module,exports){(function(){"use strict";var Stream=require("./Stream");var CSSParser=require("./CSSParser");var HTMLParser=require("./HTMLParser");var DOMBuilder=require("./DOMBuilder");var Slowparse={HTML_ELEMENT_NAMES:HTMLParser.prototype.voidHtmlElements.concat(HTMLParser.prototype.htmlElements.concat(HTMLParser.prototype.obsoleteHtmlElements)),CSS_PROPERTY_NAMES:CSSParser.prototype.cssProperties,replaceEntityRefs:HTMLParser.replaceEntityRefs,Stream:Stream,HTML:function(document,html,options){options=options||{};var stream=new Stream(html),domBuilder,parser,warnings=null,error=null,errorDetectors=options.errorDetectors||[],disallowActiveAttributes=typeof options.disallowActiveAttributes==="undefined"?false:options.disallowActiveAttributes;domBuilder=new DOMBuilder(disallowActiveAttributes);parser=new HTMLParser(stream,domBuilder);try{var _=parser.parse();if(_.warnings){warnings=_.warnings}}catch(e){if(e.parseInfo){error=e.parseInfo}else throw e}errorDetectors.forEach(function(detector){if(!error)error=detector(html,domBuilder.fragment.node)||null});return{document:domBuilder.fragment.node,contexts:domBuilder.contexts,warnings:warnings,error:error}},findError:function(html,errorDetectors){return this.HTML(document,html,errorDetectors).error}};if(typeof define!=="undefined"){define(function(){return Slowparse})}else if(typeof module!=="undefined"&&module.exports){module.exports=Slowparse}else if(typeof window!=="undefined"){window.Slowparse=Slowparse}})()},{"./CSSParser":1,"./DOMBuilder":2,"./HTMLParser":4,"./Stream":8}],11:[function(require,module,exports){module.exports=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"]},{}]},{},[10])(10)});