define(function(require,exports,module){"use strict";var Strings=brackets.getModule("strings"),StringUtils=brackets.getModule("utils/StringUtils"),AnimationUtils=brackets.getModule("utils/AnimationUtils");var BEZIER_CURVE_VALID_REGEX=/cubic-bezier\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/,BEZIER_CURVE_GENERAL_REGEX=/cubic-bezier\((.*)\)/,EASE_STRICT_REGEX=/[: ,]ease(?:-in)?(?:-out)?[ ,;]/,EASE_LAX_REGEX=/ease(?:-in)?(?:-out)?/,LINEAR_STRICT_REGEX=/transition.*?[: ,]linear[ ,;]/,LINEAR_LAX_REGEX=/linear/,STEPS_VALID_REGEX=/steps\(\s*(\d+)\s*(?:,\s*(\w+)\s*)?\)/,STEPS_GENERAL_REGEX=/steps\((.*)\)/,STEP_STRICT_REGEX=/[: ,](?:step-start|step-end)[ ,;]/,STEP_LAX_REGEX=/step-start|step-end/;var BEZIER=1,STEP=2;function _convertToNumber(str){if(typeof str!=="string"){return{isNumber:false,value:null}}var val=parseFloat(+str,10),isNum=typeof val==="number"&&!isNaN(val)&&val!==Infinity&&val!==-Infinity;return{isNumber:isNum,value:val}}function _getValidBezierParams(match){var param,def=[".42","0",".58","1"],oldIndex=match.index,originalString=match[0],i;if(match){match=match[1].split(",")}if(match){for(i=0;i<=3;i++){if(match[i]){match[i]=match[i].trim();param=_convertToNumber(match[i]);if(!param.isNumber){match[i]=undefined}else if(i===0||i===2){if(param.value<0){match[i]="0"}else if(param.value>1){match[i]="1"}}}if(!match[i]){match[i]=def[i]}}}else{match=def}match=match.splice(0,4);match="cubic-bezier("+match.join(", ")+")";match=match.match(BEZIER_CURVE_VALID_REGEX);if(match){match.index=oldIndex;match.originalString=originalString;return match}return null}function _validateCubicBezierParams(match){var x1=_convertToNumber(match[1]),y1=_convertToNumber(match[2]),x2=_convertToNumber(match[3]),y2=_convertToNumber(match[4]);if(!x1.isNumber||!y1.isNumber||!x2.isNumber||!y2.isNumber){return false}if(x1.value<0||x1.value>1||x2.value<0||x2.value>1){return false}return true}function _getValidStepsParams(match){var param,def=["5","end"],params=def,oldIndex=match.index,originalString=match[0];if(match){match=match[1].split(",")}if(match){if(match[0]){param=match[0].replace(/[\s\"']/g,"");param=_convertToNumber(param);if(!param.isNumber){param.value=def[0]}else if(param.value){param.value=Math.floor(param.value)}if(param.value<1){param.value=def[0]}params[0]=param.value}if(match[1]){param=match[1].replace(/[\s\"']/g,"");param=param.substr(0,1);if(param==="s"){params[1]="start"}else{params[1]="end"}}}params="steps("+params.join(", ")+")";params=params.match(STEPS_VALID_REGEX);if(params){params.index=oldIndex;params.originalString=originalString;return params}return null}function _validateStepsParams(match){var count=_convertToNumber(match[1]);if(!count.isNumber||count.value<1||Math.floor(count.value)!==count.value){return false}if(match[2]&&match[2]!=="start"&&match[2]!=="end"){return false}return true}function showHideHint(hint,show,documentCode,editorCode){if(!hint||!hint.elem){return}if(show){hint.shown=true;hint.animationInProgress=false;hint.elem.removeClass("fadeout");hint.elem.html(StringUtils.format(Strings.INLINE_TIMING_EDITOR_INVALID,documentCode,editorCode));hint.elem.css("display","block")}else if(hint.shown){hint.animationInProgress=true;AnimationUtils.animateUsingClass(hint.elem[0],"fadeout",750).done(function(){if(hint.animationInProgress){hint.elem.hide()}hint.shown=false;hint.animationInProgress=false})}else{hint.elem.hide()}}function _tagMatch(match,type){switch(type){case BEZIER:match.isBezier=true;break;case STEP:match.isStep=true;break}return match}function bezierCurveMatch(str,lax){var match;match=str.match(BEZIER_CURVE_VALID_REGEX);if(match&&_validateCubicBezierParams(match)){return _tagMatch(match,BEZIER)}match=str.match(BEZIER_CURVE_GENERAL_REGEX);if(match){match=_getValidBezierParams(match);if(match&&_validateCubicBezierParams(match)){return _tagMatch(match,BEZIER)}else{window.console.log("brackets-cubic-bezier: TimingFunctionUtils._getValidBezierParams created invalid code")}}if(lax){match=str.match(EASE_LAX_REGEX);if(match){return _tagMatch(match,BEZIER)}}else{match=str.match(EASE_STRICT_REGEX);if(match){return _tagMatch(str.match(EASE_LAX_REGEX),BEZIER)}}if(lax){match=str.match(LINEAR_LAX_REGEX);if(match){return _tagMatch(match,BEZIER)}}else{match=str.match(LINEAR_STRICT_REGEX);if(match){return _tagMatch(str.match(LINEAR_LAX_REGEX),BEZIER)}}return null}function stepsMatch(str,lax){var match;match=str.match(STEPS_VALID_REGEX);if(match&&_validateStepsParams(match)){return _tagMatch(match,STEP)}match=str.match(STEPS_GENERAL_REGEX);if(match){match=_getValidStepsParams(match);if(match&&_validateStepsParams(match)){return _tagMatch(match,STEP)}else{window.console.log("brackets-steps: TimingFunctionUtils._getValidStepsParams created invalid code")}}if(lax){match=str.match(STEP_LAX_REGEX);if(match){return _tagMatch(match,STEP)}}else{match=str.match(STEP_STRICT_REGEX);if(match){return _tagMatch(str.match(STEP_LAX_REGEX),STEP)}}return null}function timingFunctionMatch(str,lax){return bezierCurveMatch(str,lax)||stepsMatch(str,lax)}exports.timingFunctionMatch=timingFunctionMatch;exports.bezierCurveMatch=bezierCurveMatch;exports.stepsMatch=stepsMatch;exports.showHideHint=showHideHint});