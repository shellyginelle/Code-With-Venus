define(function(require,exports,module){"use strict";var EditorManager=brackets.getModule("editor/EditorManager"),QuickOpen=brackets.getModule("search/QuickOpen"),DocumentManager=brackets.getModule("document/DocumentManager"),StringMatch=brackets.getModule("utils/StringMatch");function FileLocation(fullPath,line,chFrom,chTo,id){this.fullPath=fullPath;this.line=line;this.chFrom=chFrom;this.chTo=chTo;this.id=id}function createIDList(){var doc=DocumentManager.getCurrentDocument();if(!doc){return}var idList=[];var docText=doc.getText();var lines=docText.split("\n");var regex=new RegExp(/\s+id\s*?=\s*?["'](.*?)["']/gi);var id,chFrom,chTo,i,line;for(i=0;i<lines.length;i++){line=lines[i];var info;while((info=regex.exec(line))!==null){id=info[1];chFrom=line.indexOf(id);chTo=chFrom+id.length;idList.push(new FileLocation(null,i,chFrom,chTo,id))}}return idList}function search(query,matcher){var idList=matcher.idList;if(!idList){idList=createIDList();matcher.idList=idList}query=query.slice(query.indexOf("@")+1,query.length);var filteredList=$.map(idList,function(fileLocation){var searchResult=matcher.match(fileLocation.id,query);if(searchResult){searchResult.fileLocation=fileLocation}return searchResult});StringMatch.basicMatchSort(filteredList);return filteredList}function match(query){return query[0]==="@"}function itemFocus(selectedItem,query,explicit){if(!selectedItem||query.length<2&&!explicit){return}var fileLocation=selectedItem.fileLocation;var from={line:fileLocation.line,ch:fileLocation.chFrom};var to={line:fileLocation.line,ch:fileLocation.chTo};EditorManager.getCurrentFullEditor().setSelection(from,to,true)}function itemSelect(selectedItem,query){itemFocus(selectedItem,query,true)}QuickOpen.addQuickOpenPlugin({name:"html ids",languageIds:["html"],search:search,match:match,itemFocus:itemFocus,itemSelect:itemSelect})});