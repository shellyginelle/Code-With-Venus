define(function(require,exports,module){"use strict";var CodeHintManager=brackets.getModule("editor/CodeHintManager"),ExtensionUtils=brackets.getModule("utils/ExtensionUtils"),CommandManager=brackets.getModule("command/CommandManager"),Menus=brackets.getModule("command/Menus"),PreferencesManager=brackets.getModule("preferences/PreferencesManager");var CDNHintProvider=require("modules/CDNHintProvider").CDNHintProvider,LibraryList=require("modules/CDNLibraryList").LibraryList,API=require("modules/jsdelivrAPI"),CDNs=JSON.parse(require("text!modules/CDNs.json")),CDNStrings=require("modules/strings"),CDNCommands=require("modules/commands"),CDNPrefs=require("modules/prefs");var prefs=PreferencesManager.getExtensionPrefs("cdn-suggestions"),stateManager=PreferencesManager.stateManager.getPrefixedSystem("cdn-suggestions");function downloadLibraries(cdns,callback){var libraryList=new LibraryList,cdnResponses=0;cdns.forEach(function(cdn){API.getLibraries(cdn.name,function(err,libraries){if(err){console.log(err)}else{libraryList.addCDN(cdn.name,libraries)}cdnResponses++;console.log("Downloaded",cdnResponses,"of",cdns.length,"CDNs.");if(cdnResponses===cdns.length){callback(libraryList)}})})}function registerHintProvider(libraryList){var cdnHintProvider=new CDNHintProvider(libraryList);CodeHintManager.registerHintProvider(cdnHintProvider,["html"],10)}function registerCommands(){CommandManager.register(CDNStrings.CMD_USE_HTTPS,CDNCommands.USE_HTTPS,function(){var id=CDNPrefs.USE_HTTPS.id,useHTTPS=!prefs.get(id);prefs.set(id,useHTTPS);prefs.save()})}function registerPreference(pref){var prefObj=prefs.definePreference(pref.id,pref.type,pref.initial);prefs.save();return prefObj}function setupMenus(){var menu=Menus.getMenu(Menus.AppMenuBar.EDIT_MENU);menu.addMenuDivider();menu.addMenuItem(CDNCommands.USE_HTTPS)}function toggleMenuItem(command,prefId){var value=prefs.get(prefId);CommandManager.get(command).setChecked(value)}registerCommands();registerPreference(CDNPrefs.USE_HTTPS).on("change",function(){toggleMenuItem(CDNCommands.USE_HTTPS,CDNPrefs.USE_HTTPS.id)});setupMenus();downloadLibraries(CDNs,registerHintProvider)});